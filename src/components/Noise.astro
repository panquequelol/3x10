---
interface Props {
  class?: string;
}

const { class: className = "" } = Astro.props;
---

<div class={`noise-container ${className}`} aria-hidden="true">
  <canvas class="noise-canvas"></canvas>
</div>

<style>
  .noise-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.15;
    overflow: hidden;
  }

  .noise-canvas {
    width: 100%;
    height: 100%;
  }

  @media (prefers-reduced-motion: reduce) {
    .noise-container {
      display: none;
    }
  }
</style>

<script>
  function initNoise() {
    const canvas = document.querySelector('.noise-canvas');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function createNoiseTexture() {
      const imageData = ctx.createImageData(canvas.width, canvas.height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        const value = Math.random() * 255;
        data[i] = value;     // red
        data[i + 1] = value; // green
        data[i + 2] = value; // blue
        data[i + 3] = 255;   // alpha
      }

      ctx.putImageData(imageData, 0, 0);
    }

    resizeCanvas();
    createNoiseTexture();

    let animationId;
    function animate() {
      createNoiseTexture();
      animationId = requestAnimationFrame(animate);
    }

    // Start animation with a delay
    setTimeout(() => {
      animate();
    }, 100);

    // Handle resize
    window.addEventListener('resize', () => {
      resizeCanvas();
      createNoiseTexture();
    });

    // Cleanup
    return () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
    };
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', initNoise);
</script>